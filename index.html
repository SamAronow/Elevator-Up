<!DOCTYPE html>
<html>
<head>
  <title>Elevator Up - Room Select</title>
  <style>
    button {
      padding: 10px 20px;
      font-size: 18px;
      margin: 10px;
      cursor: pointer;
    }

    #player-count-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    #popup-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
    }

    #popup-content h2 {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Elevator Up </h1>
  <button onclick="openPlayerCountPopup()">Create Room</button>
  <button onclick="joinRoom()">Join Room</button>

  <!-- Player Count Popup -->
  <div id="player-count-popup" style="display: none;">
    <div id="popup-content">
      <h2>Choose number of players</h2>
      <button onclick="createRoom(2)">2 Players</button>
      <button onclick="createRoom(3)">3 Players</button>
      <button onclick="createRoom(4)">4 Players</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="database.js"></script>
  <script>
    function randomCode(length = 4) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      return Array.from({ length }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
    }

    function openPlayerCountPopup() {
      document.getElementById("player-count-popup").style.display = "flex";
    }

    async function createRoom(playerCount) {
      const code = randomCode();

      const writes = [
        write(`/${code}/initialized`, false),
        write(`/${code}/gameStarted`, false),
        write(`/${code}/playerCount`, playerCount)
      ];

      for (let i = 1; i <= playerCount; i++) {
        writes.push(write(`/${code}/Player${i}/Used`, false));
      }

      await Promise.all(writes);
      window.location.href = `room.html?room=${code}`;
    }

    function joinRoom() {
      const input = prompt("Enter room code:");
      if (!input) return;
      const code = input.toUpperCase();
      read(`/${code}/initialized`).then(exists => {
        if (exists !== null) {
          window.location.href = `room.html?room=${code}`;
        } else {
          alert("Room not found!");
        }
      });
    }
  </script>
</body>
</html>
