<!DOCTYPE html>
<html>
<head>
  <title>Elevator Up</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    /* Add this to your existing styles */
.input-container {
    position: relative;
    margin-bottom: 1rem;
}

.input-error {
    border-color: #ff6b6b !important;
    box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25) !important;
    /* Force border-radius to stay */
    border-radius: var(--original-radius, 0.5rem) !important; 
}

/* Make sure your original input has this */
.form-control {
    border-radius: 0.5rem; /* Ensure this matches the error state */
}

.error-message {
    color: #ff6b6b;
    font-size: 0.8rem;
    margin-top: 0.5rem;
    text-align: center;
    position: absolute;
    bottom: -1.25rem;
    left: 0;
    right: 0;
}

.shake-error {
    animation: shake 0.5s;
    /* Maintain radius during animation */
    border-radius: var(--original-radius, 0.5rem) !important;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
    20%, 40%, 60%, 80% { transform: translateX(4px); }
}
    
    body {
      overflow-x: hidden;
      position: relative;
    }
    
    .cloud {
      position: absolute;
      color: rgba(255, 255, 255, 0.1);
      font-size: 3rem;
      z-index: 0;
      pointer-events: none;
      animation: cloudFloat linear infinite;
    }
    
    .cloud.right {
      animation-name: cloudFloatRight;
    }
    
    @keyframes cloudFloat {
      0% {
        transform: translateX(-10vw);
      }
      100% {
        transform: translateX(110vw);
      }
    }
    
    @keyframes cloudFloatRight {
      0% {
        transform: translateX(110vw);
      }
      100% {
        transform: translateX(-10vw);
      }
    }
    
    .main-container {
      position: relative;
      z-index: 1;
    }

    :root {
      --primary-bg: linear-gradient(135deg, #1e1e2f 0%, #2d2d44 100%);
      --accent-color: #f0e68c;
      --accent-hover: #e8dc8b;
      --dark-bg: #1a1a2e;
      --darker-bg: #16213e;
    }
    
    body {
      background: var(--primary-bg);
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .main-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .game-title {
      font-size: 3.5rem;
      font-weight: 700;
      color: var(--accent-color);
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.6);
      margin-bottom: 2rem;
      letter-spacing: 1px;
    }

    .game-subtitle {
      font-size: 1.2rem;
      opacity: 0.8;
      margin-bottom: 3rem;
    }

    .btn-custom {
      background-color: var(--accent-color);
      color: var(--dark-bg);
      border: none;
      font-weight: 600;
      padding: 0.8rem 1.5rem;
      border-radius: 50px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(240, 230, 140, 0.3);
      min-width: 200px;
    }

    .btn-custom:hover {
      background-color: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(240, 230, 140, 0.4);
    }

    .btn-custom:active {
      transform: translateY(0);
    }

    .btn-dark-custom {
      background-color: var(--darker-bg);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .btn-dark-custom:hover {
      background-color: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .modal-content {
      background-color: var(--dark-bg);
      color: white;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    animation: slideUpFadeIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1) forwards;    }
    /* Add these with your other styles */
.popup-overlay {
    animation: fadeIn 0.2s ease-out forwards;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUpFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}


    .modal-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-footer {
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .form-control {
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      text-transform: uppercase;
      text-align: center;
      font-size: 1.2rem;
      letter-spacing: 2px;
      padding: 0.75rem 1rem;
    }

    .form-control:focus {
      background-color: rgba(255, 255, 255, 0.15);
      border-color: var(--accent-color);
      color: white;
      box-shadow: 0 0 0 0.25rem rgba(240, 230, 140, 0.25);
    }

    .player-count-btn {
      padding: 1rem;
      font-size: 1.1rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .player-count-btn:hover {
      transform: scale(1.03);
    }

    .game-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: var(--accent-color);
    }

    .footer {
      margin-top: 3rem;
      opacity: 0.6;
      font-size: 0.9rem;
    }

    /* Custom popup styles for your JS logic */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1050;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <!-- Floating clouds -->
   
  <div class="cloud" style="top: 20%; left: 5%; animation-duration: 40s;"><i class="bi bi-cloud"></i></div>
  <div class="cloud" style="top: 30%; left: 20%; animation-duration: 50s;"><i class="bi bi-cloud"></i></div>
  <div class="cloud" style="bottom: 25%; left: 15%; animation-duration: 45s;"><i class="bi bi-cloud"></i></div>
  <div class="cloud right" style="top: 15%; right: 5%; animation-duration: 60s;"><i class="bi bi-cloud"></i></div>
  <div class="cloud right" style="bottom: 30%; right: 20%; animation-duration: 55s;"><i class="bi bi-cloud"></i></div>
  <div class="cloud right" style="top: 40%; right: 15%; animation-duration: 65s;"><i class="bi bi-cloud"></i></div>

  <div class="container main-container text-center py-5">
    <div class="game-icon">
      <i class="bi bi-building"></i>
    </div>
    <h1 class="game-title">Elevator Up</h1>
    
    <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mb-5">
      <button class="btn btn-lg btn-custom" onclick="openPlayerCountPopup()">
        <i class="bi bi-plus-circle me-2"></i>Create Room
      </button>
      <button class="btn btn-lg btn-custom" onclick="openJoinPopup()">
        <i class="bi bi-people-fill me-2"></i>Join Room
      </button>
    </div>
  </div>

 <div id="player-count-popup" class="popup-overlay" onclick="closePopups(event)">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 600px;" onclick="event.stopPropagation()">
    <div class="modal-content p-4">
      <div class="modal-header border-0 position-relative">
        <h2 class="modal-title w-100 text-center text-uppercase" style="letter-spacing: 2px; color: var(--accent-color);">New Game</h2>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" onclick="document.getElementById('player-count-popup').style.display = 'none'; localStorage.removeItem('openPopup');"></button>
      </div>
      <div class="modal-body py-4">
        <div class="text-center px-4">
          <i class="bi bi-people-fill mb-3" style="font-size: 2rem; color: var(--accent-color);"></i>
          <p class="mb-4 opacity-75">How many players?</p>
          <div class="d-grid gap-2 mx-auto" style="min-width: 300px;">
            <button class="btn btn-dark-custom btn-lg d-flex align-items-center" onclick="createRoom(2)" style="position: relative;">
              <span class="w-100 text-center">2 Players</span>
              <span class="badge bg-accent text-dark position-absolute end-0 me-3"></span>
            </button>
            <button class="btn btn-dark-custom btn-lg d-flex align-items-center" onclick="createRoom(3)" style="position: relative;">
              <span class="w-100 text-center">3 Players</span>
              <span class="badge bg-accent text-dark position-absolute end-0 me-3"></span>
            </button>
            <button class="btn btn-dark-custom btn-lg d-flex align-items-center" onclick="createRoom(4)" style="position: relative;">
              <span class="w-100 text-center">4 Players</span>
              <span class="badge bg-accent text-dark position-absolute end-0 me-3"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Join Popup -->
  <div id="join-popup" class="popup-overlay" onclick="closePopups(event)">
    <div class="modal-dialog modal-dialog-centered"> <!-- Add this wrapper -->
    <div class="modal-content p-4" onclick="event.stopPropagation()">
      <div class="modal-header border-0 position-relative">
        <h2 class="modal-title w-100 text-center text-uppercase" style="letter-spacing: 2px; color: var(--accent-color);">Join Game</h2>
        <button type="button" class="btn-close btn-close-white position-absolute end-0 me-3" onclick="document.getElementById('join-popup').style.display = 'none'; localStorage.removeItem('openPopup');"></button>
      </div>
      <div class="modal-body py-4">
        <div class="d-flex justify-content-center">
          <div class="text-center">
            <div class="mb-3">
              <h5 style="color: var(--accent-color); letter-spacing: 1px;">ENTER ROOM CODE</h5>
            </div>
            <div class="input-group mb-4">
              <input type="text" id="room-code-input" class="form-control form-control-lg text-center py-3" 
                     style="letter-spacing: 5px; font-weight: bold;" 
                     placeholder="A B C D" maxlength="4" 
                     oninput="formatRoomCode(this)">
            </div>
            <div class="error-message"></div>
            <button class="btn btn-custom w-100 py-3 fw-bold" onclick="submitJoinRoom()">
              JOIN GAME <i class="bi bi-arrow-right ms-2"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer border-0 justify-content-center">
      </div>
    </div>
    </div>
  </div>
  

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="database.js"></script>
  <script>
    function randomCode(length = 4) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      return Array.from({ length }, () => chars[Math.floor(Math.random() * chars.length)]).join('');
    }

function formatRoomCode(input) {
    // Remove all spaces and convert to uppercase
    let value = input.value.replace(/\s/g, '').toUpperCase();
    
    // Limit to 4 actual characters (ignore spaces in count)
    value = value.substring(0, 4);
    
    // Add spaces between characters
    let formatted = '';
    for (let i = 0; i < value.length; i++) {
        if (i > 0) formatted += ' ';
        formatted += value[i];
    }
    
    // Update the input value
    input.value = formatted;
    
    // Expand max length to accommodate spaces
    localStorage.setItem("roomCodeValue", value);
    input.setAttribute('maxlength', 7); // 4 chars + 3 spaces
}

    function openPlayerCountPopup() {
      document.getElementById("player-count-popup").style.display = "flex";
      localStorage.setItem("openPopup", "playerCount");
    }

    function openJoinPopup() {
      document.getElementById("join-popup").style.display = "flex";
      const input = document.getElementById("room-code-input");
      input.value = '';
      input.focus();
      localStorage.setItem("openPopup", "join");
    }

    function closePopups(event) {
      if (event.target.classList.contains('popup-overlay')) {
        document.getElementById("player-count-popup").style.display = "none";
        document.getElementById("join-popup").style.display = "none";
        localStorage.removeItem("openPopup");
        localStorage.removeItem("roomCodeValue");
      }
    }

    async function createRoom(playerCount) {
      localStorage.removeItem("openPopup");
      localStorage.removeItem("roomCodeValue");

      const code = randomCode();

      const players = {};
      for (let i = 1; i <= playerCount; i++) {
        players[i] = { Used: false };
      }

      await Promise.all([
        write(`/${code}/players`, players),
        write(`/${code}/initialized`, false),
        write(`/${code}/gameStarted`, false),
        write(`/${code}/playerCount`, playerCount)
      ]);

      window.location.href = `room.html?room=${code}`;
    }async function submitJoinRoom() {
    const input = document.getElementById("room-code-input");
    const code = input.value.replace(/\s/g, '').trim().toUpperCase();
    
    // Clear previous errors
    hideInputError(input);
    
    if (!code || code.length !== 4) {
        showInputError(input, "Please enter a 4-letter code");
        return;
    }

    try {
        const roomRef = firebase.database().ref(`/${code}`);
        const snapshot = await roomRef.once('value');
        
        if (!snapshot.exists()) {
            showInputError(input, "Room doesn't exist");
            return;
        }

        localStorage.removeItem("openPopup");
        localStorage.removeItem("roomCodeValue");
        window.location.href = `room.html?room=${code}`;
        
    } catch (error) {
        console.error("Database check failed:", error);
        showInputError(input, "Connection error. Please try again.");
    }
}

function showInputError(inputElement, message) {
    // Store original border radius
    const originalRadius = getComputedStyle(inputElement).borderRadius;
    inputElement.dataset.originalRadius = originalRadius;
    
    // Apply error styles (preserving radius)
    inputElement.classList.add('input-error');
    inputElement.style.borderRadius = originalRadius; // Force maintain radius
    
    const container = inputElement.closest('.input-container') || inputElement.parentNode;
    
    // Create/update error message
    let errorDisplay = container.querySelector('.error-message');
    if (!errorDisplay) {
        errorDisplay = document.createElement('div');
        errorDisplay.className = 'error-message';
        container.appendChild(errorDisplay);
    }
    errorDisplay.textContent = message;
    
    // Apply shake animation
    inputElement.classList.add('shake-error');
    
    // Clear any existing timeout
    if (inputElement.errorTimeout) {
        clearTimeout(inputElement.errorTimeout);
    }
    
    // Remove shake after animation completes
    setTimeout(() => {
        inputElement.classList.remove('shake-error');
        // Explicitly restore radius after shake
        inputElement.style.borderRadius = inputElement.dataset.originalRadius;
    }, 500);
    
    // Remove all error styles after 1 second
    inputElement.errorTimeout = setTimeout(() => {
        inputElement.classList.remove('input-error');
        errorDisplay.textContent = '';
        // Final radius restoration
        inputElement.style.borderRadius = inputElement.dataset.originalRadius;
    }, 1500);
}

function hideInputError(inputElement) {
    // Clear any pending timeout
    if (inputElement.errorTimeout) {
        clearTimeout(inputElement.errorTimeout);
    }
    
    // Restore all styles
    inputElement.classList.remove('input-error', 'shake-error');
    if (inputElement.dataset.originalRadius) {
        inputElement.style.borderRadius = inputElement.dataset.originalRadius;
    }
    
    // Clear error message
    const container = inputElement.closest('.input-container') || inputElement.parentNode;
    const errorDisplay = container.querySelector('.error-message');
    if (errorDisplay) {
        errorDisplay.textContent = '';
    }
}

// On page load - restore both popup and value
window.addEventListener("load", () => {
    const openPopup = localStorage.getItem("openPopup");
    const savedCode = localStorage.getItem("roomCodeValue");
    
    if (openPopup === "join") {
        const input = document.getElementById("room-code-input");
        openJoinPopup();
        input.value = savedCode;
        formatRoomCode(input)
    } else if (openPopup === "playerCount") {
        openPlayerCountPopup();
    }
});

    document.getElementById("room-code-input").addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        submitJoinRoom();
      }
    });
  </script>
</body>
</html>